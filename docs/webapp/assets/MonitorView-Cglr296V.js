import{e as B,D as x,E as q,G as E,l as D,f as l,o as d,g as s,v as Q,x as e,A as o,t as n,cs as y,n as j,m as h,F as C,s as R,ab as v,Z as _,ad as f,aw as k,a2 as T,cu as F,_ as G}from"./confirm-UqIPX_kE.js";import{P as b}from"./prompt-DHQQ_qzX.js";class g{constructor(a,m){this.width=a,this.height=m}add(a){return new g(this.width+a.width,this.height+a.height)}reduce(a){return new g(this.width-a.width,this.height-a.height)}equals(a){return this.width===a.width&&this.height===a.height}}class O{x;y;width;height;constructor(a,m,c,u){if(m!==void 0&&c!==void 0&&u!==void 0)this.x=a,this.y=m,this.width=c,this.height=u;else{const p=JSON.parse(a);this.x=p.x,this.y=p.y,this.width=p.width,this.height=p.height}}get json(){return JSON.stringify({x:this.x,y:this.y,width:this.width,height:this.height})}get style(){return{left:`${this.x}px`,top:`${this.y}px`,width:`${this.width}px`,height:`${this.height}px`}}get size(){return new g(this.width,this.height)}multiply(a){return new O(this.x*a,this.y*a,this.width*a,this.height*a)}}class w{constructor(a,m){this.x=a,this.y=m}add(a){return new w(this.x+a.x,this.y+a.y)}reduce(a){return new w(this.x-a.x,this.y-a.y)}distanceTo(a){return Math.sqrt((this.x-a.x)**2+(this.y-a.y)**2)}angleTo(a){return Math.atan2(a.y-this.y,a.x-this.x)}multiply(a){return new w(this.x*a,this.y*a)}equals(a){return this.x===a.x&&this.y===a.y}}const J={class:"full"},Z={class:"headers"},z={key:0,class:"entry"},H={class:"label"},K={key:0,class:"label warning"},W={class:"label"},X={class:"key"},Y={class:"key"},ee={key:1},te={class:"key"},se={class:"timestamp"},ae={key:2},oe={class:"key"},ie={key:3},ne={class:"command"},le={key:4,class:"timestamp"},de={key:5},re={class:"key"},ce={key:6},he={class:"command"},ue={key:7,class:"timestamp"},ve={class:"row"},me=["onClick"],_e=["onClick"],pe={key:1,class:"entry"},ye={class:"label"},Se={key:0,class:"label warning"},ge={class:"label"},ke={class:"key"},we={class:"key"},Ie={class:"key"},xe={class:"timestamp"},De={key:1},fe={class:"key"},$e={key:2},Me={class:"command"},Ce={key:3,class:"timestamp"},Re={key:4},Te={class:"key"},Fe={key:5},be={class:"command"},Oe={key:6,class:"timestamp"},Ue={class:"row"},Ne=["onClick"],Ve=["onClick"],Ae={key:1,class:"main"},Le={class:"footer"},Pe={key:0},Be=B({__name:"MonitorView",props:{size:{type:g,required:!0}},setup(U){let a=null;const m=x(F()),c=x({os:F(),usiSessions:[],csaSessions:[]}),u=x(0);function p(){_.collectSessionStates().then(i=>{m.value=c.value.os,c.value=i,u.value=new Date().getTime()}).catch(i=>{f().add(i)})}function S(i,r){return`${((r-i)/1e3).toFixed(3)} seconds ago`}q(()=>{p(),a=window.setInterval(p,1e3)}),E(()=>{a!==null&&(window.clearInterval(a),a=null)});const $=D(()=>c.value.os.memoryFree!==void 0?c.value.os.memoryFree/1024**2:null),M=D(()=>c.value.os.memoryFree!==void 0&&c.value.os.memoryTotal?c.value.os.memoryFree/c.value.os.memoryTotal*100:null),N=D(()=>{const i=c.value.os.cpuTotalTime-m.value.cpuTotalTime,r=c.value.os.cpuIdleTime-m.value.cpuIdleTime;return i?(1-r/i)*100:0});function V(i){_.log(k.INFO,`MonitorView: Open USI prompt for SID=${i.sessionID} Name=[${i.name}]`),_.openPrompt(b.USI,i.sessionID,i.name)}function A(i){T().show({message:`${i.name} に "quit" を送信します。本当に実行しますか？`,onOk:()=>{_.log(k.INFO,`MonitorView: Send USI quit command to SID=${i.sessionID} Name=[${i.name}]`),_.usiQuit(i.sessionID).catch(r=>{f().add(r)})}})}function L(i){_.log(k.INFO,`MonitorView: Open CSA prompt for SID=${i.sessionID} Server=[${i.host}:${i.port}]`);const r=`${i.host}:${i.port}`;_.openPrompt(b.CSA,i.sessionID,r)}function P(i){T().show({message:`${i.host}:${i.port} への接続を強制終了します。本当に実行しますか？`,onOk:()=>{_.log(k.INFO,`MonitorView: Close CSA session for SID=${i.sessionID} Server=[${i.host}:${i.port}]`),_.csaLogout(i.sessionID).catch(r=>{f().add(r)})}})}return(i,r)=>(d(),l("div",null,[s("div",J,[s("div",{ref:"root",class:"full column",onCopy:r[0]||(r[0]=Q(()=>{},["stop"]))},[s("div",Z,[s("div",null,e(o(n).updatedAt)+": "+e(u.value?o(y)(new Date(u.value)):"---"),1),s("div",null,e(o(n).usiEngine)+": "+e(c.value.usiSessions.length),1),s("div",null,e(o(n).csaServer)+": "+e(c.value.csaSessions.length),1)]),u.value?(d(),l("div",{key:0,class:"main",style:j({height:`${U.size.height-38}px`})},[c.value.usiSessions.length===0?(d(),l("div",z,[s("div",H,e(o(n).noRunningUSIEngine),1)])):h("",!0),(d(!0),l(C,null,R(c.value.usiSessions,t=>(d(),l("div",{key:t.sessionID,class:"entry"},[t.closed?(d(),l("div",K,e(o(n).willBeRemovedFromTheListSoon),1)):h("",!0),s("div",W,e(o(n).usiEngine)+" - SID: "+e(t.sessionID),1),s("div",null,[s("span",X,e(o(n).name)+":",1),v(" "+e(t.name),1)]),s("div",null,[r[1]||(r[1]=s("span",{class:"key"},"URI:",-1)),v(" "+e(t.uri),1)]),s("div",null,[s("span",Y,e(o(n).enginePath)+":",1),v(" "+e(t.path),1)]),t.pid?(d(),l("div",ee,[r[2]||(r[2]=s("span",{class:"key"},"PID:",-1)),v(" "+e(t.pid),1)])):h("",!0),s("div",null,[s("span",te,e(o(n).createdAt)+":",1),v(" "+e(o(y)(new Date(t.createdMs)))+" ",1),s("span",se,"("+e(S(t.createdMs,u.value))+")",1)]),s("div",null,[r[3]||(r[3]=s("span",{class:"key"},"State:",-1)),v(" "+e(t.stateCode),1)]),t.lastSent?(d(),l("div",ae,[s("span",oe,e(o(n).lastSent)+":",1)])):h("",!0),t.lastSent?(d(),l("div",ie,[s("span",ne,e(t.lastSent.command||`(${o(n).blankLine})`),1)])):h("",!0),t.lastSent?(d(),l("div",le," Sent at "+e(o(y)(new Date(t.lastSent.timeMs)))+" ("+e(S(t.lastSent.timeMs,u.value))+") ",1)):h("",!0),t.lastReceived?(d(),l("div",de,[s("span",re,e(o(n).lastReceived)+":",1)])):h("",!0),t.lastReceived?(d(),l("div",ce,[s("span",he,e(t.lastReceived.command||`(${o(n).blankLine})`),1)])):h("",!0),t.lastReceived?(d(),l("div",ue," Received at "+e(o(y)(new Date(t.lastReceived.timeMs)))+" ("+e(S(t.lastReceived.timeMs,u.value))+") ",1)):h("",!0),s("div",ve,[s("button",{onClick:I=>V(t)},e(o(n).openPrompt),9,me),s("button",{onClick:I=>A(t)},e(o(n).forceQuit),9,_e)])]))),128)),c.value.csaSessions.length===0?(d(),l("div",pe,[s("div",ye,e(o(n).noConnectedCSAServer),1)])):h("",!0),(d(!0),l(C,null,R(c.value.csaSessions,t=>(d(),l("div",{key:t.sessionID,class:"entry"},[t.closed?(d(),l("div",Se,e(o(n).willBeRemovedFromTheListSoon),1)):h("",!0),s("div",ge,e(o(n).csaServer)+" - SID: "+e(t.sessionID),1),s("div",null,[s("span",ke,e(o(n).server)+":",1),v(" "+e(t.host)+":"+e(t.port),1)]),s("div",null,[s("span",we,e(o(n).protocolVersion)+":",1),v(" "+e(t.protocolVersion),1)]),s("div",null,[r[4]||(r[4]=s("span",{class:"key"},"ID:",-1)),v(" "+e(t.loginID),1)]),s("div",null,[s("span",Ie,e(o(n).createdAt)+":",1),v(" "+e(o(y)(new Date(t.createdMs)))+" ",1),s("span",xe,"("+e(S(t.createdMs,u.value))+")",1)]),s("div",null,[r[5]||(r[5]=s("span",{class:"key"},"State:",-1)),v(" "+e(t.stateCode),1)]),t.lastSent?(d(),l("div",De,[s("span",fe,e(o(n).lastSent)+":",1)])):h("",!0),t.lastSent?(d(),l("div",$e,[s("span",Me,e(t.lastSent.command||`(${o(n).blankLine})`),1)])):h("",!0),t.lastSent?(d(),l("div",Ce," Sent at "+e(o(y)(new Date(t.lastSent.timeMs)))+" ("+e(S(t.lastSent.timeMs,u.value))+") ",1)):h("",!0),t.lastReceived?(d(),l("div",Re,[s("span",Te,e(o(n).lastReceived)+":",1)])):h("",!0),t.lastReceived?(d(),l("div",Fe,[s("span",be,e(t.lastReceived.command||`(${o(n).blankLine})`),1)])):h("",!0),t.lastReceived?(d(),l("div",Oe," Received at "+e(o(y)(new Date(t.lastReceived.timeMs)))+" ("+e(S(t.lastReceived.timeMs,u.value))+") ",1)):h("",!0),s("div",Ue,[s("button",{onClick:I=>L(t)},e(o(n).openPrompt),9,Ne),s("button",{onClick:I=>P(t)},e(o(n).forceClose),9,Ve)])]))),128))],4)):(d(),l("div",Ae,"Collecting...")),s("div",Le,[s("span",null,e(c.value.os.version)+"/"+e(c.value.os.arch),1),s("span",null,"CPU Usage: "+e(N.value.toFixed(1))+"%",1),$.value!==null&&M.value!==null?(d(),l("span",Pe," Memory Free: "+e($.value.toFixed(2))+"GiB ("+e(M.value.toFixed(1))+"%) ",1)):h("",!0)])],544)])]))}}),Qe=G(Be,[["__scopeId","data-v-6d18e6dd"]]);export{Qe as M,w as P,g as R,O as a};
